<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VSABrains Narrative Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Fraunces:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="brand-mark">VSA</div>
          <div>
            <div class="brand-title">VSABrains</div>
            <div class="brand-subtitle">Narrative Trajectory Demo</div>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="btn ghost" id="generateCleanBtn">Generate Clean Story</button>
          <button class="btn primary" id="generateContradictBtn">Generate Contradicting Story</button>
          <div class="append-mode">
            <label for="appendMode">Append Mode</label>
            <select id="appendMode">
              <option value="consistent">Clean</option>
              <option value="contradicting">Contradicting</option>
            </select>
          </div>
          <button class="btn ghost" id="addHundredBtn">Add 100 Actions</button>
        </div>
      </header>

      <main class="grid simple">
        <section class="panel viz">
          <div class="viz-header">
            <h2>Memory Grid</h2>
            <div class="tab-row">
              <button class="tab-btn active" data-tab="grid">Grid</button>
              <button class="tab-btn" data-tab="story">Story</button>
            </div>
          </div>
          <div class="canvas-wrap tab-panel" data-panel="grid">
            <canvas id="gridCanvas" width="640" height="640"></canvas>
          </div>
          <div class="story-block tab-panel hidden" data-panel="story">
            <label for="storyField">Story (Read-only)</label>
            <textarea id="storyField" rows="18" readonly></textarea>
          </div>
          <div class="grid-meta">
            <span id="stepValue">Step 0</span>
            <span id="contradictionsValue">Contradictions: 0</span>
          </div>
        </section>

        <section class="panel control">
          <h2>Queries</h2>
          <p class="muted">Try at least 10 query types to explore reasoning and contradictions.</p>
          <div class="field">
            <label for="queryType">Query Type</label>
            <select id="queryType">
              <option value="where">Where is an entity (latest)?</option>
              <option value="whereAt">Where is an entity (at step)?</option>
              <option value="entitiesAt">Who is in a location?</option>
              <option value="inventory">What does an entity have?</option>
              <option value="whoHas">Who has an item?</option>
              <option value="itemLocation">Where is an item?</option>
              <option value="isAlive">Is an entity alive?</option>
              <option value="lastEvent">Last event for entity</option>
              <option value="timeline">Timeline for entity</option>
              <option value="contradictions">All contradictions</option>
              <option value="contradictionsFor">Contradictions for entity</option>
            </select>
          </div>

          <div class="field" id="queryEntityField">
            <label for="queryEntity">Entity</label>
            <select id="queryEntity"></select>
          </div>

          <div class="field" id="queryItemField">
            <label for="queryItem">Item</label>
            <select id="queryItem"></select>
          </div>

          <div class="field" id="queryLocationField">
            <label for="queryLocation">Location</label>
            <select id="queryLocation"></select>
          </div>

          <div class="field" id="queryStepField">
            <label for="queryStep">Step</label>
            <input type="number" id="queryStep" min="0" placeholder="Latest" />
          </div>

          <div class="field" id="queryLimitField">
            <label for="queryLimit">Limit</label>
            <input type="number" id="queryLimit" min="1" value="6" />
          </div>

          <button class="btn primary" id="runQueryBtn">Run Query</button>

          <div class="story-block">
            <label for="queryAnswer">Answer</label>
            <textarea id="queryAnswer" rows="8" readonly></textarea>
          </div>

          <div class="status" id="statusMsg"></div>
        </section>
      </main>
    </div>

    <script type="module" src="app.js"></script>
  </body>
</html>
