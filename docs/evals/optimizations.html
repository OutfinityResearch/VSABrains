<div class="section">
  <h2>Optimization Ideas and Compression Sweep</h2>
  <p>
    This page answers a practical question: can we compress the representation without losing the
    essence? The short answer is “yes, but selectively.” The most reliable wins come from reducing
    map capacity and write pressure, while keeping the index sharp enough for localization.
  </p>
  <p class="note">
    Plain-language version: we can often store less by saving fewer tokens per cell or by writing
    less frequently, but we must keep enough signal to still find past events.
  </p>

  <h3>Brainstorming: Where Compression Can Come From</h3>
  <table class="table">
    <thead>
      <tr>
        <th>Idea</th>
        <th>How it helps</th>
        <th>Main risk</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Lower heavy-hitters <code>k</code></td><td>Directly shrinks per-cell storage</td><td>More saturation / collisions</td></tr>
      <tr><td>Smaller grids (or sparse maps)</td><td>Fewer distinct cells, better cache behavior</td><td>Higher aliasing if too small</td></tr>
      <tr><td>Write gating / write every N steps</td><td>Reduces both map and index growth</td><td>Loses fine detail</td></tr>
      <tr><td>Summary tokens (slow maps)</td><td>Compresses long runs into coarse anchors</td><td>Replay becomes more important</td></tr>
      <tr><td>Stronger decay / pruning</td><td>Forgets stale or weak signals</td><td>May drop rare but important events</td></tr>
      <tr><td>Semantic pre-compression</td><td>Encode facts/events, not raw tokens</td><td>Extractor quality becomes critical</td></tr>
      <tr><td>Adaptive column budgets</td><td>Spend columns only when ambiguity is high</td><td>Needs a robust trigger policy</td></tr>
    </tbody>
  </table>

  <h3>Compression Sweep (Exp4 Proxies)</h3>
  <p class="note">
    We ran a small sweep on Exp4 with the same noise and column count, varying grid size and
    heavy-hitters capacity <code>k</code>. The metrics below are lower-bound proxies (not exact
    memory measurements).
  </p>
  <p>
    How to read this: lower “Total Bytes Proxy” is better for memory, while “Consensus Acc” shows
    whether we lost accuracy. The goal is to reduce bytes without hurting accuracy.
  </p>

  <table class="table">
    <thead>
      <tr>
        <th>Variant</th>
        <th>Consensus Acc</th>
        <th>Total Bytes Proxy</th>
        <th>Change vs Baseline</th>
        <th>Work Ratio (baseline ÷ VSA)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Baseline (64x64, k=4)</td><td>0.992</td><td>135 KB</td><td>—</td><td>~209×</td></tr>
      <tr><td>Lower K (64x64, k=2)</td><td>0.992</td><td>83.5 KB</td><td>~38% smaller</td><td>~209×</td></tr>
      <tr><td>Smaller grid + lower K (32x32, k=2)</td><td>0.992</td><td>80.7 KB</td><td>~40% smaller</td><td>~209×</td></tr>
    </tbody>
  </table>

  <h3>Visual: Storage Proxy Reduction</h3>
  <img src="../assets/svgs/exp4-compression-bytes.svg" alt="Compression sweep total bytes proxy" style="width: 100%; max-width: 980px; height: auto; border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; background: white;">
  <p class="note">
    In this sweep, reducing <code>k</code> from 4 to 2 provides the clearest storage win while
    preserving accuracy under the current Exp4 setup.
  </p>

  <h3>Interpretation and Next Steps</h3>
  <table class="table">
    <thead>
      <tr>
        <th>Takeaway</th>
        <th>What it suggests</th>
      </tr>
    </thead>
    <tbody>
      <tr><td><code>k</code> matters a lot</td><td>A smaller <code>k</code> is a strong first compression lever</td></tr>
      <tr><td>Grid size matters less here</td><td>With this short run, grid aliasing is not yet the bottleneck</td></tr>
      <tr><td>Index cap did not bite</td><td>The stream is too small to hit the index limit; larger runs are needed</td></tr>
      <tr><td>Accuracy stayed flat</td><td>These changes seem safe on Exp4, but should be checked on Exp1/Exp2</td></tr>
    </tbody>
  </table>

  <p class="note">
    Compression sweep run: 2026-01-27T13:29:59Z. Script: <code>eval/exp4-consensus/compression-sweep.mjs</code>.
  </p>
</div>
