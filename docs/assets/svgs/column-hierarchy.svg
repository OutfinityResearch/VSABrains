<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 220" role="img" aria-label="Column map and cell hierarchy">
  <defs>
    <style>
      .frame { fill: #ffffff; stroke: rgba(0,0,0,0.08); stroke-width: 2; rx: 12; ry: 12; }
      .box { fill: #ffffff; stroke: #0f172a; stroke-width: 1.5; rx: 10; ry: 10; }
      .child { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 1.2; rx: 8; ry: 8; }
      .title { font: 600 14px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; fill: #0f172a; }
      .label { font: 500 12px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; fill: #334155; }
      .edge { stroke: #0f172a; stroke-width: 1.6; fill: none; }
    </style>
  </defs>

  <rect class="frame" x="6" y="6" width="968" height="208"></rect>

  <rect class="box" x="20" y="20" width="220" height="60"></rect>
  <text class="title" x="130" y="46" text-anchor="middle">Column</text>
  <text class="label" x="130" y="66" text-anchor="middle">per-column state</text>

  <path class="edge" d="M 240 50 L 300 50"></path>
  <path class="edge" d="M 300 50 L 300 180"></path>

  <path class="edge" d="M 300 50 L 330 50"></path>
  <rect class="child" x="330" y="24" width="240" height="52"></rect>
  <text class="title" x="450" y="46" text-anchor="middle">GridMap fast[0..F-1]</text>
  <text class="label" x="450" y="64" text-anchor="middle">Cell[x][y] → HeavyHitters(K)</text>

  <path class="edge" d="M 300 95 L 330 95"></path>
  <rect class="child" x="330" y="69" width="240" height="52"></rect>
  <text class="title" x="450" y="91" text-anchor="middle">GridMap slow[0..S-1]</text>
  <text class="label" x="450" y="109" text-anchor="middle">optional slow summaries</text>

  <path class="edge" d="M 300 140 L 330 140"></path>
  <rect class="child" x="330" y="114" width="280" height="52"></rect>
  <text class="title" x="470" y="136" text-anchor="middle">DisplacementEncoder</text>
  <text class="label" x="470" y="154" text-anchor="middle">context buffer of stepTokenIds</text>

  <path class="edge" d="M 300 185 L 330 185"></path>
  <rect class="child" x="330" y="159" width="280" height="52"></rect>
  <text class="title" x="470" y="181" text-anchor="middle">LocationIndex</text>
  <text class="label" x="470" y="199" text-anchor="middle">stepTokenId → candidate locations</text>
</svg>

